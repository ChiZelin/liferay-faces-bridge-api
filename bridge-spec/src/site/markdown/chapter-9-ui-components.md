_Version: 6.0.0-pr-SNAPSHOT_

# 9. UI Components

* * *

The JSF 2.2 Specification requires the **JSF runtime** to implement renderers for `UIComponent` classes that are defined
in the JSF API module. In most cases, these renderers function equally well in both webapp and portlet environments.
However, some component renderers must be overridden by the FacesBridge in order for them to function properly in a
portlet environment.

## <a name="9.1"></a>9.1 h:body

According to the portlet specification, elements such as `<head>`, `<title>`, and `<body>` may not be output to the
response by a portlet. Because of this, the FacesBridge must prevent the Faces runtime from writing `<body>...</body>`
to the response when it invokes the renderer for `<h:body/>`. Instead, the FacesBridge must ensure that a
`<div>...</div>` is written and the value of the "id" attribute must be the clientId of the UIViewRoot.

The FacesBridge must also support the following use-case:

    <?xml version="1.0" encoding="UTF-8"?>
    <f:view xmlns="http://www.w3.org/1999/xhtml"
	    xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
	    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
	    <h:head />
	    <h:body>
		    <h:form>
			    <h:commandButton>
				    <f:ajax execute="@form" render="@all" />
			    </h:commandButton>
		    </h:form>
	    </h:body>
    </f:view>

When the commandButton is clicked, this will cause a partial-response similar to the following to be generated by the
FacesRuntime:

    <partial-response id="j_id1">
	    <changes>
		    <update id="javax.faces.ViewRoot">
			    <![CDATA[...]]>
		    </update>
	    <update id="j_id1:javax.faces.ViewState:0">
		    <![CDATA[ -234567890098765432:123456789076543217 ]]>
	    </update>
	    </changes>
    </partial-response>

In this scenario, the FacesBridge must ensure that only the `<div>...</div>` is replaced in the client rather than the
entire `<body>...</body>`.

The manner in which the FacesBridge fulfills this requirement is an implementation detail. One possibility is for the
FacesBridge to provide a custom jsf.js resource. Another might be for the FacesBridge to introduce a custom
`ResponseWriter` that monitors calls to `ResponseWriter.startElement(String name, UIComponent component)` and
`ResponseWriter.writeAttribute(String name, Object value, String property)` in order to transform value of the id
attribute from "javax.faces.ViewRoot" to the id of the `<div>...</div>`.

As a consequence of the FacesBridge specifying the id of the `<div>...</div>` "javax.faces.ViewRoot", the JavaScript
code
in the Mojarra implementation of jsf.js will not be able to dynamically add the `<input type="hidden"
name="javax.faces.ViewState"/>` hidden field to forms. Because of this, FacesBridge must ensure that this takes place,
but the manner in which it takes place is an implementation detail. Note that this will not be a problem with JSF 2.3,
due to the solution provided by
[JAVASERVERFACES_SPEC_PUBLIC-790](https://github.com/javaee/javaserverfaces-spec/issues/790) in the Faces runtime.

Test: <sup>[[9.1](tck-tests.md#9.1)]</sup>

## <a name="9.2"></a>9.2 h:head

According to the portlet specification, elements such as `<head>`, `<title>`, and `<body>` may not be output to the
response by a portlet. Because of this, the FacesBridge must prevent the Faces runtime from writing `<head>...</head>`
to the response when it invokes the renderer for `h:head`. Instead, the FacesBridge must ensure that a JSF resources
(which are targeted for the head) are _added_ to the head by calling `HeaderResponse.addResourceDependency(String name,
String scope, String version, String markup)` for each resource.

The following Facelet markup demonstrates usage of the `h:head` tag as well as the "jsf.js" resource being targeted for
the head due to the presence of the `f:ajax` tag:

    <f:view xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html">
        <h:head/>
        <h:form>
            <h:inputText>
                <f:ajax render="@form" />
            </h:inputText>
        </h:form>
    </f:view>

Test: <sup>[[9.2](tck-tests.md#9.2)]</sup>

## <a name="9.3"></a>9.3 h:inputFile

The `h:inputFile` component tag causes an instance of
[javax.faces.component.html.HtmlInputFile](https://javaserverfaces.github.io/docs/2.2/javadocs/javax/faces/component/html/HtmlInputFile.html)
to be placed in the component tree. The FacesBridge must support the following typical use-cases, typically by
overriding the corresponding renderer provided by the JSF runtime. Java backing beans may be managed by CDI and/or the
Managed Bean Facility:

XHTML Facelet View:

    <ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
	    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
	    <h:form enctype="multipart/form-data">
		    <h:inputFile value="#{htmlInputFileBackingBean.uploadedPart}" />
		    <h:commandButton value="Submit" />
	    </h:form>
    </ui:composition>
  
Java Backing Bean:

    @Named
    @RequestScoped
    public class HtmlInputFileBackingBean {
    
    	private javax.servlet.http.Part uploadedPart;

    	public void setUploadedPart(javax.servlet.http.Part uploadedPart) {
    		this.uploadedPart = uploadedPart;
    	}
    }

The FacesBridge must also support uploading of files via XmlHttpRequest using the standard `<f:ajax/>` tag.

XHTML Facelet View:

    <ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
	    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
	    <h:form enctype="multipart/form-data">
		    <h:inputFile id="file" 
			    value="#{htmlInputFileBackingBean.uploadedPart}">
			    <f:ajax render="@form" />
			</h:inputFile>
	    </h:form>
    </ui:composition>

Test: <sup>[[9.3](tck-tests.md#9.3)]</sup>
